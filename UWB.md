# UWB测试记录

## 通讯协议

- 使用USB串口通讯，波特率921600，数据位8，终止位1.每行输入位
- 按行读取，头三位为头帧（55），功能位（a0），本机ID（ex.01）
- 16位为目前检测到的节点数
- 16*i+1位为对应节点编号，之后三位为两点间距离（除以1000), 16*i+13/14为透传数据长度位，之后为透传数据

## 调试日志

### 2019.2.22

- 测试应用算法进行定位，手动设定四个基站位置，使用三点定位+最小二乘测量目标位置。
- 在 x y 轴上没有明显的抖动和误差，但是 z 轴数据明显失准。因为当所有基站在 z 轴同平面或位置时，该轴定位失准，同理 y 轴。
- 因此，在编队时可能因为直线队列而导致 y 轴失准，需要对队列进行设计。
- 为实现定位，需要获取其他飞机（基站）的实时位置，因此要使用 UWB 进行彼此通讯。

### 2019.2.23

- 测试通讯方法。串口协议自带透传方式，即使用串口写入数据，会发送到全局，使其他设备能够同步接收。
- 发送数据时，头2位为所传输数据的长度，之后为传输的数据。
- 需要了解时钟同步状态，判断是否能够实现在20帧以上的通讯，各节点发送数据后能够在本地完成计算，计算时间在50ms之内。

### 2019.2.28

- 测试数据收发

### 2019.3.1

- 设计透传发送数据和读取方式：

    1. 开始循环
    1. 读取一行信息
    1. 根据行中获得的信息读取全部节点的距离和相对位置，建立相对位置矩阵
    1. 根据矩阵求出目前该点坐标，在本地保留
    1. 发送自己的信息至全局
    1. 结束当前循环

- 问题：

    1. 是否需要将该点计算出的在相对坐标系下的位置发送到全局
    1. 在编码信息时，改用字典形式储存位置信息，是否可以对字典排序后，依次将距离打印给串口，会导致当有一个信标接受数据不全时，就无法进行计算

### 2019.3.5

- master 分支测试通过，能够对其他端口使用 sennd_test ，主端口使用 serial_test 的情况下获取全局位置
- 建立新分支 v1.0_test ，实现全部 UWB 端口使用 serial_test 文件，读取其他点信息
- 新建 read_byte 读取串口数据，并修改主函数逻辑，先发送自己数据，再进行读取
- 新建 init 函数，对系统进行初始化